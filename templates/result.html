<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Report - AgroVision</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Slab:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS VARIABLES (Matches Home Page) --- */
        :root {
            --primary: #2ecc71;
            --primary-dark: #27ae60;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --text-dark: #2d3436;
            --text-light: #636e72;
            --bg-light: #f9fbfd;
            --glass: rgba(255, 255, 255, 0.9);
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --radius: 16px;
        }

        /* Dynamic Theme Colors based on Result */
        .theme-healthy { --status-color: var(--primary); --status-bg: rgba(46, 204, 113, 0.1); }
        .theme-disease { --status-color: var(--danger); --status-bg: rgba(231, 76, 60, 0.1); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-light); color: var(--text-dark); padding-bottom: 80px; }

        /* --- LAYOUT UTILS --- */
        .container { max-width: 1000px; margin: 0 auto; padding: 0 1.5rem; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 50px; font-weight: 600; text-decoration: none; transition: 0.3s; border: none; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-secondary { background: white; border: 2px solid #eee; color: var(--text-dark); }
        .btn-secondary:hover { border-color: var(--primary); }

        /* --- NAVBAR --- */
        .navbar { background: white; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #eee; padding: 1rem 0; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
        .nav-logo a { font-family: 'Roboto Slab', serif; font-size: 1.5rem; font-weight: 700; color: var(--primary-dark); text-decoration: none; }
        .nav-menu { display: flex; gap: 2rem; list-style: none; }
        .nav-menu a { text-decoration: none; color: var(--text-dark); font-weight: 500; }
        .nav-menu a.active { color: var(--primary); }

        /* --- RESULT CARD --- */
        .result-section { padding: 3rem 0; }
        .report-card { background: white; border-radius: 24px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05); }
        
        /* Status Header */
        .report-header { padding: 2rem; text-align: center; border-bottom: 1px solid #eee; background: var(--status-bg); }
        .status-badge { display: inline-block; padding: 6px 16px; border-radius: 30px; background: white; color: var(--status-color); font-weight: 700; margin-bottom: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .disease-title { font-family: 'Roboto Slab', serif; font-size: 2.5rem; color: var(--status-color); margin-bottom: 0.5rem; }

        /* Grid Layout */
        .report-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 0; }
        
        /* Left Column: Image */
        .report-image-col { padding: 2rem; background: #fcfcfc; border-right: 1px solid #eee; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .uploaded-image { width: 100%; max-width: 350px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); object-fit: cover; }
        .confidence-box { margin-top: 1.5rem; width: 100%; max-width: 350px; }
        .confidence-label { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; font-weight: 600; color: var(--text-light); }
        .meter-bg { height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden; }
        .meter-fill { height: 100%; background: var(--status-color); width: 0%; transition: width 1.5s ease-out; border-radius: 5px; }

        /* Right Column: Details */
        .report-details-col { padding: 2.5rem; }
        .detail-block { margin-bottom: 2rem; }
        .detail-block h3 { font-size: 1.1rem; color: var(--text-dark); margin-bottom: 0.8rem; display: flex; align-items: center; gap: 8px; }
        .detail-content { background: var(--bg-light); padding: 1.25rem; border-radius: 12px; border-left: 4px solid var(--status-color); line-height: 1.6; color: var(--text-light); }
        
        /* Action Buttons */
        .report-actions { padding: 2rem; background: #f8f9fa; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .action-group { display: flex; gap: 1rem; }

        /* Error State */
        .error-card { text-align: center; padding: 4rem 2rem; background: white; border-radius: 24px; box-shadow: var(--shadow); }
        .error-icon { font-size: 4rem; margin-bottom: 1rem; }

        /* Mobile Nav & Responsive */
        .mobile-bottom-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; z-index: 999; padding: 10px 0; }
        .mobile-bottom-nav ul { display: flex; justify-content: space-around; list-style: none; }
        .mobile-bottom-nav a { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #999; font-size: 0.75rem; }
        .mobile-bottom-nav a.active { color: var(--primary); }

        @media (max-width: 768px) {
            .nav-menu { display: none; }
            .mobile-bottom-nav { display: block; }
            .report-grid { grid-template-columns: 1fr; }
            .report-image-col { border-right: none; border-bottom: 1px solid #eee; }
            .disease-title { font-size: 2rem; }
            .report-actions { flex-direction: column; text-align: center; }
            .action-group { width: 100%; justify-content: center; }
            .btn { width: 100%; justify-content: center; }
        }
        
        @media print {
            .navbar, .mobile-bottom-nav, .report-actions, .btn { display: none !important; }
            body { background: white; padding: 0; }
            .report-card { box-shadow: none; border: 1px solid #000; }
        }
    </style>
</head>

{% set is_healthy = 'Healthy' in disease or 'healthy' in disease %}
<body class="{% if is_healthy %}theme-healthy{% else %}theme-disease{% endif %}">

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="/">üåæ <span data-lang="appName">AgroVision</span></a>
            </div>
            <ul class="nav-menu">
                <li><a href="/" data-lang="navHome">Home</a></li>
                <li><a href="/detect" class="active" data-lang="navDetect">Detect Disease</a></li>
                <li><a href="/schemes" data-lang="navSchemes">Govt Schemes</a></li>
            </ul>
            <select id="languageSelect" onchange="changeLanguage(this.value)" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd; cursor: pointer;">
                <option value="en">English</option>
                <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
            </select>
        </div>
    </nav>

    <main class="main-content">
        <section class="result-section">
            <div class="container">
                
                {% if error %}
                    <div class="error-card animate-fade-in">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <h2>Analysis Failed</h2>
                        <p style="margin-bottom: 2rem; color: #666;">{{ error }}</p>
                        <a href="/detect" class="btn btn-primary">Try Again</a>
                    </div>
                {% else %}
                    <div class="report-card animate-slide-up">
                        
                        <div class="report-header">
                            <span class="status-badge">
                                {% if is_healthy %}‚úÖ Healthy Crop{% else %}‚ö†Ô∏è Infection Detected{% endif %}
                            </span>
                            <h1 class="disease-title">{{ disease }}</h1>
                            <p style="color: var(--text-light);">Analyzed on <span id="currentDate"></span></p>
                        </div>

                        <div class="report-grid">
                            <div class="report-image-col">
                                {% if image_url %}
                                    <img src="{{ image_url }}" alt="Analyzed Crop" class="uploaded-image">
                                {% else %}
                                    <div style="padding: 3rem; background: #eee; border-radius: 12px;">üì∑ No Image</div>
                                {% endif %}
                                
                                <div class="confidence-box">
                                    <div class="confidence-label">
                                        <span>AI Confidence Score</span>
                                        <span>{{ confidence }}%</span>
                                    </div>
                                    <div class="meter-bg">
                                        <div class="meter-fill" id="confidenceBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="report-details-col">
                                <button onclick="speakReport()" class="btn btn-secondary" style="margin-bottom: 1.5rem; width: auto; font-size: 0.9rem;">
                                    üîä Listen to Report
                                </button>

                                <div class="detail-block">
                                    <h3>üíä Treatment / Remedy</h3>
                                    <div class="detail-content" id="cureText">
                                        {{ cure }}
                                    </div>
                                </div>

                                {% if prevention %}
                                <div class="detail-block">
                                    <h3>üõ°Ô∏è Prevention Tips</h3>
                                    <div class="detail-content" id="preventionText">
                                        {{ prevention }}
                                    </div>
                                </div>
                                {% endif %}

                                <div class="detail-block" style="margin-bottom: 0;">
                                    <h3>‚ÑπÔ∏è Note</h3>
                                    <p style="font-size: 0.9rem; color: #888; font-style: italic;">
                                        Results are generated by AI. For severe cases, please consult an agricultural officer.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="report-actions">
                            <a href="/detect" class="btn btn-secondary" data-lang="btnAnalyzeAnother">‚Üê Analyze Another</a>
                            <div class="action-group">
                                <button onclick="window.print()" class="btn btn-secondary">üñ®Ô∏è Print</button>
                                <a href="/schemes" class="btn btn-primary" data-lang="btnViewSchemes">View Related Schemes ‚Üí</a>
                            </div>
                        </div>
                    </div>
                {% endif %}

            </div>
        </section>
    </main>

    <nav class="mobile-bottom-nav">
        <ul>
            <li><a href="/"><span style="font-size:1.4rem">üè†</span><span data-lang="navHome">Home</span></a></li>
            <li><a href="/detect" class="active"><span style="font-size:1.4rem">üì∏</span><span data-lang="navDetect">Detect</span></a></li>
            <li><a href="/schemes"><span style="font-size:1.4rem">üèõÔ∏è</span><span data-lang="navSchemes">Schemes</span></a></li>
        </ul>
    </nav>

    <script>
        // 1. Set Date
        const dateEl = document.getElementById('currentDate');
        if(dateEl) dateEl.textContent = new Date().toLocaleDateString();

        // 2. Animate Confidence Bar
        setTimeout(() => {
            const bar = document.getElementById('confidenceBar');
            if(bar) bar.style.width = "{{ confidence }}%";
        }, 300);

        // 3. Text-to-Speech Feature (Accessibility)
        function speakReport() {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();

                const disease = "{{ disease }}";
                const cure = document.getElementById('cureText').innerText;
                const text = `Analysis Report. The detected result is ${disease}. Here is the recommended treatment: ${cure}`;

                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to set a clear English voice
                const voices = window.speechSynthesis.getVoices();
                utterance.voice = voices.find(voice => voice.lang === 'en-US') || voices[0];
                
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Voice output is not supported in this browser.");
            }
        }
    </script>
    
    <!-- Language Translation Module -->
    <script src="/static/js/lang.js"></script>
</body>
</html>